# -*- coding: utf-8 -*-
"""
-------------------------------------------------
   File Name :      broadcast_attack_with_linear_padding.sage
   Description :
   Author :         x3nny
   date :           2021/7/14
-------------------------------------------------
   Change Activity:
                    2021/7/14: Init
-------------------------------------------------
"""
__author__ = 'x3nny'

# coding:utf-8
from sage.all_cmdline import *   # import sage library
from Crypto.Util.number import *
#
Cs =  [1238876592861016520515167930598264568635129081677574746869953134577449452922236196007301206478478313067921010486025605185814424962837955312642378524526732523856204194814159719935747120453541261655243539189177547337830666530580042780717870939949603272622178880454187768941322919459454253853420364404266687987383312175181270959072540710814098901866704579030310033363080270600739559634426527441066374541082624, 1288032290569717234495492072096974957243056898603388755800360723885232425452787316696269583416162381390604328879759646033624426906759105796963539157862261266316366768295692596105866659127945007805214903211567291104573885391559097760965036330060916927387700926887517595633608600372832070094369375360392541427648056657146422968973279069024704124001698291633727009083556408812926616039465357148154857187500000, 1338736057494375292885927036566489394993529952257265571067067530229294613597029277443676895272768357185539420410308316227076037076000275239775749559019740270445898224168906141189382001615424513664347525616198002385107105303522054751917195959371440262461394496817462511696690908819795013424309119206005186613039012475909681545100698592878928669170506194989297932907352063692589169947023102114356633474661376, 1391024174318524523828963003093459240749331121380357323960875556754347676963924265399910526898207544282531971983947251834986470823178319881820399613266750499375857066571730107789902047424505922215901077062365016779970596205297367211648357483994710658282498610690067130822730318594764119979683487076903615215297060661125320874026759514377345261999568645186066913743148562685220977067480401161660881059312032, 1444933484200146076376845223455423385247923440253167957235310548939417996339401771531646373560778613538265023403917638980555443889694053211063757414721998193875918933501877087207702044904634575968653385106416777721896349402535050161868055929094322894601405730738359250561269119758175679650682871670771413457005281604547713840682870678931967689732307133807612239907077026895880241629647822654724184209850368]
Ns =  [1884326552861193192776266671759866542448939975077329532990929550917115773511369471379213026919526328594909130768578488164361804653779858101782292168409590466677811937516165711839036851296532287059608962501709007247251554020578135137127203292889028604226239355109326827682694740186545737548249304181918200106365207180397121390547083963574984350148676635100280054693203461661812601539577031627168990758486494345813979918794447344464384474632445602714534928755225669580567165781446355591057929841152535327545322076747310507233569996855394102300245885337603608812934597314020423069524121132320235260324838753792956764721, 417965649123940049391077783997801521088169090810006724126563108252684516514857823825511735642239340864911440699214178579634282749863982203970772389992689285902418848667404795389369321717527079526768267750120595483715412042414199665315868299057227048099541686080117676524276542935295910186362112926395109068180618173758014910932906109780227378230673998786367100426375979383406171860256444235735961806116988217747841967160031168653990207958830269559567441933774974429328403296492293053123236082753417045790912068170981357573263314717121064081308966287183269146360892737660610345057142917025814877867304016112850911089, 90500334810328125578398415909390416643735203734049035226385492069535982702015855880852916343336913096171015520601196495545246668148532598802685208043816459698976917817967484145070169689638052746111963005673218812205634161002935423612465180040785520537276902273663154072899115219450320833330617880238445167089967616795653508704539907905666984561908381858039638898512514939305235485866014161050884037903692655936305073830737265247954702222841014008820067363858163035948082863719230618694998599112074876800033251590314354864220108311280707805844184653483108811529391108623743279464350186053161995733796800825718435197, 6262155080485922352251130891817726089495889231430529445815842237176577599243502368870272634030538747208850792950792918954791184590123530211318802124924786362119843008774830647892249358494561007786674376756034872609032710723593250051296790577798259126932616386402724813449432760746188723120285906208222957113232157320700387466729838972326556110572870586662873184017128918000361703415351570385726339540280275138220984422371872434759910912299457479163354667508932981526719117285166922368806874903513503476055753521745566709699824249290447431382034014815275304531952727493568684522232215484911746620014805851092434479663, 342027856259090826542271645582717630266600985962049211782920871238671067301148373108237475263396819998253141085814141625650435382550510545094179002748271135550708533155229211659482788122892455972247433146250932795311153905948614476625544894298679027182035431321578815097836243998313815076489771018028293848359360101327418360994810610660668755836335607158278008372923272619750201296634667418661525214167031105814843145428498255181739220553623068185990807966158577896430634593991952928886524163099558412059294854210226193891543236234818480353345223177410025161355440030159211866865539447314194777498492218017469022839]
A=  [128, 129, 130, 131, 132]
B= [1024, 1025, 1026, 1027, 1028]
e= 5
a = 731111971045863129770849213414583830513204814328949766909151
b =  456671883153709362919394459405008275757410555181682705944711
n =  666147691257100304060287710111266554526660232037647662561651
s =  [16985619148410545083429542035273917746612, 32633736473029292963326093326932585135645, 20531875000321097472853248514822638673918, 37524613187648387324374487657224279011, 21531154020699900519763323600774720747179, 1785016578450326289280053428455439687732, 15859114177482712954359285501450873939895, 10077571899928395052806024133320973530689, 30199391683019296398254401666338410561714, 21303634014034358798100587236618579995634]
PR = PolynomialRing(GF(666147691257100304060287710111266554526660232037647662561651), 'x')
x = PR.gen()
for i in range(len(s)):
    mbar = s[i]<<64
    f = a*(x+mbar)+b
    a*x + a*mbar + b == y + ybar
    f = f.monic()
    m = f.small_roots(X=2**64)
    print(m)
#
# # solve
# cnt = e
# PR = PolynomialRing(ZZ, 'x')
# x = PR.gen()
# Fs = []
# for i in range(cnt):
#     f = PR((A[i]*x + B[i])**e - Cs[i])   # 五个式子
#     ff = f.change_ring(Zmod(Ns[i]))
#     ff = ff.monic()
#     f = ff.change_ring(ZZ)
#     Fs.append(f)
#
#
# F = crt(Fs, Ns)
#
# M = reduce(lambda x, y: x * y, Ns)
# FF = F.change_ring(Zmod(M))
# m = FF.small_roots()    #LLL算法
#
# if m:
#     print(long_to_bytes(m[0]))
# else:
#     print('no ans')
#
#
#
# Cs =  [1137147572297822032254808212601837461321853268925670350333295718423600612759542040365045985043344055739980381759778246587093422096830152082912799997974761344472011477017836353129626549513138007663792505984687137408828683845966184993890001485824, 1164008228697032585429688447524083069804929672249211482375446439975281131651005026987344809287407568134748749150521170500553491872148203807509070497526654254443573639116909020020369342721325206477082167258582850948075884822148320380537080875000, 1338736057494375292885927036566489394993529952257265571067067530229294613597029277443676895272768357185539420410308316227076037076000275239775749559019740270445898224168906141189382001615424513664347525616198002385107105303522054751917195959371440262461394496817462511696690908819795013424309119206005186613039012475909681545100698592878928669170506194989297932907352063692589169947023102114356633474661376, 1391024174318524523828963003093459240749331121380357323960875556754347676963924265399910526898207544282531971983947251834986470823178319881820399613266750499375857066571730107789902047424505922215901077062365016779970596205297367211648357483994710658282498610690067130822730318594764119979683487076903615215297060661125320874026759514377345261999568645186066913743148562685220977067480401161660881059312032]
# PKs =  [(3, 8709150626833541174512357320876368195651273826115248113193865078806595707745430008098774251244745719961603914627196624006455862375772104009153780052789459275293625740124191749778215869984913354146965512417147067816898382811578289704600506794363248130899354333469786714236108615706102331853472067596375483491496855709930349121005128358739457671525435624186591430255664882695203927911313067263269997716398147739547082909893266141568709124913034389454880372559765823106045906973580586635648364916577830963009300712900827381174215922713924002137594555617295617335450229784892542970982367764941270280515775364677188204717), (3, 4733172141521779036579703887730848387015274279867851222610039940682057120963758409611052101877953563527977712911273651172726810048001552300199677727457373769120955172414052451140298841949822030068221052815499384788637004700476157351946881858263459145500963448172905654989521177416657333190744779098511729555045046234264627839351883571830178650901355456515204999698435865888020506291803083239337638262666596025400798439803003041696894321975918996680503870609148476306570733844433311711055824083158865440846481320968384641433078635820213242586342956672895922688147713368287060479368466125239135601518755007519697115643), (5, 19582612650714468285776604669020099004206785169736428751279309096950141998653337808190211715137322217606793854550980143016069932443389628774020110734452288202442234530155383251898213527471604531046361474360916469100859058628945205803541533762059030349288136019657147737856259786918674267753015647121600814601727543767053751987044001226777575097110555326106265619121837509685239236327652953050632269530160575945525551492967128272333661477959665123444693522636483372593812079802699144817506778949274558838709810207662204757959490117495030981108778053150156686841673299066344283186416766084657219416685550008655583981961), (5, 713537372579394579384540808712491571189788788462321284680180129970613267218701864729159662314110909585623843965788290375927084583396109992185017580742018881521357634501779027043359183816116021119494573271960499770814012158706987860425481430225545365388351139732170661085122594752893494389078272592111233456277962595375878238150917906499093541274516231053485425313710155246662725618489599647443384401326476284794152713108527893002872923164803125090641433183930207114243398604375256714564406413585730791596864746789499304356347194427131555996748417908587387816240238395760292319131322663958093807952655971105093958407)]
#
# cnt = 4
# A = [(i + 128) for i in range(cnt)]
# B = [(i + 1024) for i in range(cnt)]
# PR = PolynomialRing(ZZ, 'x')
# x = PR.gen()
#
# Fs = []
# for i in range(cnt):
#     f =  PR( ( A[i]*x + B[i] )**PKs[i][0] - Cs[i] )
#     ff = f.change_ring( Zmod(PKs[i][1]) )
#     ff = ff.monic()
#     f = ff.change_ring(ZZ)
#     Fs.append(f)
# F = crt( [ Fs[0]**2, Fs[1]**2, x*Fs[2], x*Fs[3] ], [ PKs[i][1] for i in range(cnt) ] )
#
# M = reduce( lambda x, y: x * y, [ PKs[i][1] for i in range(cnt) ] )
# FF = F.change_ring( Zmod(M) )
# m = FF.small_roots(X=2**760, beta=7./8)[0]
# print(long_to_bytes(m))